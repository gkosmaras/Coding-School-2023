@using PetShop.Models;
@using PetShop.Models.Enums;
@using PetShop.Blazor.Shared.DTO.PetFood;

@page "/petfood"
@inject HttpClient httpClient
@inject NavigationManager navigationManager
@inject IJSRuntime jsRuntime

<PageTitle>Pet Food</PageTitle>

<h1>Pet Food</h1>

@if (isLoading)
{
    <div id="app">
        <div style="position:absolute; top:30vh; width:100%; text-align:center">
            <h1>Pet food list</h1>
            <div style="display:flex; gap:10px; justify-content:center; align-items:center">
                <div class="spinner-border" role="status"></div>
                The page is loading...
            </div>
        </div>
    </div>
}
else
{

    <button class="btn btn-primary" @onclick="CreateItem">Create</button>

    <table class="table table-striped table-hover">

        <thead>
            <tr>
                <th>Animal Type</th>
                <th>Price</th>
                <th>Cost</th>
                <th>Actions</th>
            </tr>

        </thead>

        <tbody>
            @foreach (var item in petFoodList)
            {
                <tr>
                    <td>@item.AnimalType</td>
                    <td>@item.Price</td>
                    <td>@item.Cost</td>
                    <td>
                        <button class="btn btn-primary" @onclick="()=> EditItem(item)">Edit</button>
                        <button class="btn btn-danger" @onclick="()=> DeleteItem(item)">Delete</button>
                    </td>
                </tr>

            }
        </tbody>

    </table>

}

@code {
    private List<PetFoodDto> petFoodList = new();

    bool isLoading { get; set; } = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadItemsFromServer();
        isLoading = false;
    }

    private async Task LoadItemsFromServer()
    {
        petFoodList = await httpClient.GetFromJsonAsync<List<PetFoodDto>>("petfood");
    }

    private void CreateItem()
    {
        navigationManager.NavigateTo("petfood/edit");
    }

    private void EditItem(PetFoodDto petFood)
    {
        navigationManager.NavigateTo($"petfood/edit/{petFood.Id}");
    }

    private async Task DeleteItem(PetFoodDto petFood)
    {
        var confirm = await jsRuntime.InvokeAsync<bool>("confirm", "Delete Item. Are you sure?");
        if (confirm)
        {
            var response = await httpClient.DeleteAsync($"petfood/{petFood.Id}");
            response.EnsureSuccessStatusCode();
            await LoadItemsFromServer();
        }
    }
}